(function(e){"use strict";var t=e.tablesorter;e.extend({tablesorterPager:new function(){this.defaults={container:null,ajaxUrl:null,customAjaxUrl:function(e,t){return t},ajaxObject:{dataType:"json"},processAjaxOnInit:true,ajaxProcessing:function(e){return[0,[],null]},output:"{startRow} to {endRow} of {totalRows} rows",updateArrows:true,page:0,pageReset:0,size:10,savePages:true,storageKey:"tablesorter-pager",fixedHeight:false,countChildRows:false,removeRows:false,cssFirst:".first",cssPrev:".prev",cssNext:".next",cssLast:".last",cssGoto:".gotoPage",cssPageDisplay:".pagedisplay",cssPageSize:".pagesize",cssErrorRow:"tablesorter-errorRow",cssDisabled:"disabled",totalRows:0,totalPages:0,filteredRows:0,filteredPages:0,ajaxCounter:0,currentFilters:[],startRow:0,endRow:0,$size:null,last:{}};var n=this,r=function(e,t){var n="addClass",r="removeClass",i=e.cssDisabled,s=!!t,o=s||e.page===0,u=Math.min(e.totalPages,e.filteredPages),a=s||e.page===u-1||u===0;if(e.updateArrows){e.$container.find(e.cssFirst+","+e.cssPrev)[o?n:r](i).attr("aria-disabled",o);e.$container.find(e.cssNext+","+e.cssLast)[a?n:r](i).attr("aria-disabled",a)}},i=function(n,i,s){var o,u,a,f,l,c=n.config,h=c.$table.hasClass("hasFilters"),p=[],d=i.size||10;p=[c.widgetOptions&&c.widgetOptions.filter_filteredRow||"filtered",c.selectorRemove.replace(/^(\w+\.)/g,"")];if(i.countChildRows){p.push(c.cssChildRow)}l=new RegExp("("+p.join("|")+")");if(h&&!i.ajaxUrl){if(e.isEmptyObject(c.cache)){i.filteredRows=i.totalRows=c.$tbodies.eq(0).children("tr").not(i.countChildRows?"":"."+c.cssChildRow).length}else{i.filteredRows=0;e.each(c.cache[0].normalized,function(e,t){i.filteredRows+=i.regexRows.test(t[c.columns].$row[0].className)?0:1})}}else if(!h){i.filteredRows=i.totalRows}i.totalPages=Math.ceil(i.totalRows/d);c.totalRows=i.totalRows;c.filteredRows=i.filteredRows;i.filteredPages=Math.ceil(i.filteredRows/d)||0;if(Math.min(i.totalPages,i.filteredPages)>=0){p=i.size*i.page>i.filteredRows;i.startRow=p?1:i.filteredRows===0?0:i.size*i.page+1;i.page=p?0:i.page;i.endRow=Math.min(i.filteredRows,i.totalRows,i.size*(i.page+1));f=i.$container.find(i.cssPageDisplay);a=(i.ajaxData&&i.ajaxData.output?i.ajaxData.output||i.output:i.output).replace(/\{page([\-+]\d+)?\}/gi,function(e,t){return i.totalPages?i.page+(t?parseInt(t,10):1):0}).replace(/\{\w+(\s*:\s*\w+)?\}/gi,function(e){var t,n,r=e.replace(/[{}\s]/g,""),s=r.split(":"),o=i.ajaxData,u=/(rows?|pages?)$/i.test(r)?0:"";if(/(startRow|page)/.test(s[0])&&s[1]==="input"){t=(""+(s[0]==="page"?i.totalPages:i.totalRows)).length;n=s[0]==="page"?i.page+1:i.startRow;return'<input type="text" class="ts-'+s[0]+'" style="max-width:'+t+'em" value="'+n+'"/>'}return s.length>1&&o&&o[s[0]]?o[s[0]][s[1]]:i[r]||(o?o[r]:u)||u});if(f.length){f[f[0].tagName==="INPUT"?"val":"html"](a);if(i.$goto.length){p="";u=Math.min(i.totalPages,i.filteredPages);for(o=1;o<=u;o++){p+="<option>"+o+"</option>"}i.$goto[0].innerHTML=p;i.$goto[0].value=i.page+1}f.find(".ts-startRow, .ts-page").unbind("change").bind("change",function(){var t=e(this).val(),n=e(this).hasClass("ts-startRow")?Math.floor(t/i.size)+1:t;c.$table.trigger("pageSet.pager",[n])})}}r(i);if(i.initialized&&s!==false){c.$table.trigger("pagerComplete",i);if(i.savePages&&t.storage){t.storage(n,i.storageKey,{page:i.page,size:i.size})}}},s=function(t,n){var r,i,s=t.config,o=s.$tbodies.eq(0);if(n.fixedHeight){o.find("tr.pagerSavedHeightSpacer").remove();i=e.data(t,"pagerSavedHeight");if(i){r=i-o.height();if(r>5&&e.data(t,"pagerLastSize")===n.size&&o.children("tr:visible").length<n.size){o.append('<tr class="pagerSavedHeightSpacer '+s.selectorRemove.replace(/^(\w+\.)/g,"")+'" style="height:'+r+'px;"></tr>')}}}},o=function(t,n){var r=t.config.$tbodies.eq(0);r.find("tr.pagerSavedHeightSpacer").remove();e.data(t,"pagerSavedHeight",r.height());s(t,n);e.data(t,"pagerLastSize",n.size)},u=function(e,n){if(!n.ajaxUrl){var r,i=0,s=e.config,o=s.$tbodies.eq(0).children("tr"),u=o.length,a=n.page*n.size,f=a+n.size,l=s.widgetOptions&&s.widgetOptions.filter_filteredRow||"filtered",c=0;for(r=0;r<u;r++){if(!o[r].className.match(l)){if(c===a&&o[r].className.match(s.cssChildRow)){o[r].style.display="none"}else{o[r].style.display=c>=a&&c<f?"":"none";c+=o[r].className.match(s.cssChildRow+"|"+s.selectorRemove.replace(/^(\w+\.)/g,""))&&!n.countChildRows?0:1;if(c===f&&o[r].style.display!=="none"&&o[r].className.match(t.css.cssHasChild)){i=r}}}}if(i>0&&o[i].className.match(t.css.cssHasChild)){while(++i<u&&o[i].className.match(s.cssChildRow)){o[i].style.display=""}}}},a=function(t,n){n.size=parseInt(n.$size.val(),10)||n.size;e.data(t,"pagerLastSize",n.size);r(n);if(!n.removeRows){u(t,n);e(t).bind("sortEnd.pager filterEnd.pager",function(){u(t,n)})}},f=function(n,r,o,u,a){if(typeof o.ajaxProcessing==="function"){var f,l,c,h,p,d,v,m,g,y,b=r.config,w=b.$table,E="",S=o.ajaxProcessing(n,r,u)||[0,[]],x=w.find("thead th").length;t.showError(r);if(a){if(b.debug){t.log("Ajax Error",u,a)}t.showError(r,u.status===0?"Not connected, verify Network":u.status===404?"Requested page not found [404]":u.status===500?"Internal Server Error [500]":a==="parsererror"?"Requested JSON parse failed":a==="timeout"?"Time out error":a==="abort"?"Ajax Request aborted":"Uncaught error: "+u.statusText+" ["+u.status+"]");b.$tbodies.eq(0).children("tr").detach();o.totalRows=0}else{if(!e.isArray(S)){o.ajaxData=S;b.totalRows=o.totalRows=S.total;b.filteredRows=o.filteredRows=typeof S.filteredRows!=="undefined"?S.filteredRows:S.total;v=S.headers;m=S.rows}else{d=isNaN(S[0])&&!isNaN(S[1]);y=S[d?1:0];o.totalRows=isNaN(y)?o.totalRows||0:y;b.totalRows=b.filteredRows=o.filteredRows=o.totalRows;m=o.totalRows===0?[""]:S[d?0:1]||[];v=S[2]}g=m&&m.length;if(m instanceof jQuery){if(o.processAjaxOnInit){b.$tbodies.eq(0).children("tr").detach();b.$tbodies.eq(0).append(m)}}else if(g){for(f=0;f<g;f++){E+="<tr>";for(l=0;l<m[f].length;l++){E+=/^\s*<td/.test(m[f][l])?e.trim(m[f][l]):"<td>"+m[f][l]+"</td>"}E+="</tr>"}if(o.processAjaxOnInit){b.$tbodies.eq(0).html(E)}}o.processAjaxOnInit=true;if(v&&v.length===x){c=w.hasClass("hasStickyHeaders");p=c?b.widgetOptions.$sticky.children("thead:first").children("tr").children():"";h=w.find("tfoot tr:first").children();b.$headers.filter("th").each(function(n){var r=e(this),i;if(r.find("."+t.css.icon).length){i=r.find("."+t.css.icon).clone(true);r.find(".tablesorter-header-inner").html(v[n]).append(i);if(c&&p.length){i=p.eq(n).find("."+t.css.icon).clone(true);p.eq(n).find(".tablesorter-header-inner").html(v[n]).append(i)}}else{r.find(".tablesorter-header-inner").html(v[n]);if(c&&p.length){p.eq(n).find(".tablesorter-header-inner").html(v[n])}}h.eq(n).html(v[n])})}}if(b.showProcessing){t.isProcessing(r)}o.totalPages=Math.ceil(o.totalRows/(o.size||10));o.last.totalRows=o.totalRows;o.last.currentFilters=o.currentFilters;o.last.sortList=(b.sortList||[]).join(",");i(r,o);s(r,o);w.trigger("updateCache",[function(){if(o.initialized){setTimeout(function(){w.trigger("applyWidgets").trigger("pagerChange",o)},0)}}])}if(!o.initialized){o.initialized=true;e(r).trigger("applyWidgets").trigger("pagerInitialized",o)}},l=function(n,r){var i=c(n,r),s=e(document),o,u=n.config;if(i!==""){if(u.showProcessing){t.isProcessing(n,true)}s.bind("ajaxError.pager",function(e,t,i,o){f(null,n,r,t,o);s.unbind("ajaxError.pager")});o=++r.ajaxCounter;r.ajaxObject.url=i;r.ajaxObject.success=function(e,t,i){if(o<r.ajaxCounter){return}f(e,n,r,i);s.unbind("ajaxError.pager");if(typeof r.oldAjaxSuccess==="function"){r.oldAjaxSuccess(e)}};if(u.debug){t.log("ajax initialized",r.ajaxObject)}e.ajax(r.ajaxObject)}},c=function(n,r){var i=n.config,s=r.ajaxUrl?r.ajaxUrl.replace(/\{page([\-+]\d+)?\}/,function(e,t){return r.page+(t?parseInt(t,10):0)}).replace(/\{size\}/g,r.size):"",o=i.sortList,u=r.currentFilters||e(n).data("lastSearch")||[],a=s.match(/\{\s*sort(?:List)?\s*:\s*(\w*)\s*\}/),f=s.match(/\{\s*filter(?:List)?\s*:\s*(\w*)\s*\}/),l=[];if(a){a=a[1];e.each(o,function(e,t){l.push(a+"["+t[0]+"]="+t[1])});s=s.replace(/\{\s*sort(?:List)?\s*:\s*(\w*)\s*\}/g,l.length?l.join("&"):a);l=[]}if(f){f=f[1];e.each(u,function(e,t){if(t){l.push(f+"["+e+"]="+encodeURIComponent(t))}});s=s.replace(/\{\s*filter(?:List)?\s*:\s*(\w*)\s*\}/g,l.length?l.join("&"):f);r.currentFilters=u}if(typeof r.customAjaxUrl==="function"){s=r.customAjaxUrl(n,s)}if(i.debug){t.log("Pager ajax url: "+s)}return s},h=function(n,r,o){var a,f,l,c,h=e(n),p=n.config,d=p.$table.hasClass("hasFilters"),v=r&&r.length||0,m=o.page*o.size,g=o.size;if(v<1){if(p.debug){t.log("Pager: no rows for pager to render")}return}if(o.page>=o.totalPages){y(n,o)}o.isDisabled=false;if(o.initialized){h.trigger("pagerChange",o)}if(!o.removeRows){u(n,o)}else{t.clearTableBody(n);a=t.processTbody(n,p.$tbodies.eq(0),true);f=d?0:m;l=d?0:m;c=0;while(c<g&&f<r.length){if(!d||!/filtered/.test(r[f][0].className)){l++;if(l>m&&c<=g){c++;a.append(r[f])}}f++}t.processTbody(n,a,false)}i(n,o);if(!o.isDisabled){s(n,o)}if(n.isUpdating){h.trigger("updateComplete",[n,true])}},p=function(n,i){if(i.ajax){r(i,true)}else{i.isDisabled=true;e.data(n,"pagerLastPage",i.page);e.data(n,"pagerLastSize",i.size);i.page=0;i.size=i.totalRows;i.totalPages=1;e(n).addClass("pagerDisabled").removeAttr("aria-describedby").find("tr.pagerSavedHeightSpacer").remove();h(n,n.config.rowsCopy,i);e(n).trigger("applyWidgets");if(n.config.debug){t.log("pager disabled")}}i.$size.add(i.$goto).add(i.$container.find(".ts-startRow, .ts-page")).each(function(){e(this).attr("aria-disabled","true").addClass(i.cssDisabled)[0].disabled=true})},d=function(e){var t=e.config,n=t.pager;t.$table.trigger("updateCache",[function(){var r,i=[],s=e.config.cache[0].normalized;n.totalRows=s.length;for(r=0;r<n.totalRows;r++){i.push(s[r][t.columns].$row)}t.rowsCopy=i;v(e,n,true)}])},v=function(n,r,i){if(r.isDisabled){return}var s=n.config,o=e(n),u=r.last,a=Math.min(r.totalPages,r.filteredPages);if(i!==false&&r.initialized&&e.isEmptyObject(n.config.cache)){return d(n)}if(r.page<0){r.page=0}if(r.page>a-1&&a!==0){r.page=a-1}u.currentFilters=(u.currentFilters||[]).join("")===""?[]:u.currentFilters;r.currentFilters=(r.currentFilters||[]).join("")===""?[]:r.currentFilters;if(u.page===r.page&&u.size===r.size&&u.totalRows===r.totalRows&&(u.currentFilters||[]).join(",")===(r.currentFilters||[]).join(",")&&u.sortList===(s.sortList||[]).join(",")){return}if(s.debug){t.log("Pager changing to page "+r.page)}r.last={page:r.page,size:r.size,sortList:(s.sortList||[]).join(","),totalRows:r.totalRows,currentFilters:r.currentFilters||[]};if(r.ajax){l(n,r)}else if(!r.ajax){h(n,s.rowsCopy,r)}e.data(n,"pagerLastPage",r.page);if(r.initialized&&i!==false){o.trigger("pageMoved",r).trigger("applyWidgets");if(n.isUpdating){o.trigger("updateComplete",[n,true])}}},m=function(t,n,r){r.size=n||r.size||10;r.$size.val(r.size);e.data(t,"pagerLastPage",r.page);e.data(t,"pagerLastSize",r.size);r.totalPages=Math.ceil(r.totalRows/r.size);r.filteredPages=Math.ceil(r.filteredRows/r.size);v(t,r)},g=function(e,t){t.page=0;v(e,t)},y=function(e,t){t.page=Math.min(t.totalPages,t.filteredPages)-1;v(e,t)},b=function(e,t){t.page++;if(t.page>=Math.min(t.totalPages,t.filteredPages)-1){t.page=Math.min(t.totalPages,t.filteredPages)-1}v(e,t)},w=function(e,t){t.page--;if(t.page<=0){t.page=0}v(e,t)},E=function(n,r){p(n,r);r.$container.hide();n.config.appender=null;r.initialized=false;delete n.config.rowsCopy;e(n).unbind("destroy.pager sortEnd.pager filterEnd.pager enable.pager disable.pager");if(t.storage){t.storage(n,r.storageKey,"")}},S=function(n,r,i){var o,u=n.config;r.$size.add(r.$goto).add(r.$container.find(".ts-startRow, .ts-page")).removeClass(r.cssDisabled).removeAttr("disabled").attr("aria-disabled","false");r.isDisabled=false;r.page=e.data(n,"pagerLastPage")||r.page||0;r.size=e.data(n,"pagerLastSize")||parseInt(r.$size.find("option[selected]").val(),10)||r.size||10;r.$size.val(r.size);r.totalPages=Math.ceil(Math.min(r.totalRows,r.filteredRows)/r.size);if(n.id){o=n.id+"_pager_info";r.$container.find(r.cssPageDisplay).attr("id",o);u.$table.attr("aria-describedby",o)}if(i){u.$table.trigger("updateRows");m(n,r.size,r);a(n,r);s(n,r);if(u.debug){t.log("pager enabled")}}};n.appender=function(t,n){var r=t.config,s=r.pager;if(!s.ajax){r.rowsCopy=n;s.totalRows=s.countChildRows?r.$tbodies.eq(0).children("tr").length:n.length;s.size=e.data(t,"pagerLastSize")||s.size||10;s.totalPages=Math.ceil(s.totalRows/s.size);h(t,n,s);i(t,s,false)}};n.construct=function(r){return this.each(function(){if(!(this.config&&this.hasInitialized)){return}var f,l,c,h=this,x=h.config,T=x.widgetOptions,N=x.pager=e.extend(true,{},e.tablesorterPager.defaults,r),C=x.$table,k=N.$container=e(N.container).addClass("tablesorter-pager").show();if(x.debug){t.log("Pager initializing")}N.oldAjaxSuccess=N.oldAjaxSuccess||N.ajaxObject.success;x.appender=n.appender;if(t.filter&&e.inArray("filter",x.widgets)>=0){N.currentFilters=x.$table.data("lastSearch")||t.filter.setDefaults(h,x,x.widgetOptions)||[];t.setFilters(h,N.currentFilters,false)}if(N.savePages&&t.storage){f=t.storage(h,N.storageKey)||{};N.page=isNaN(f.page)?N.page:f.page;N.size=(isNaN(f.size)?N.size:f.size)||10;e.data(h,"pagerLastSize",N.size)}N.regexRows=new RegExp("("+(T.filter_filteredRow||"filtered")+"|"+x.selectorRemove.replace(/^(\w+\.)/g,"")+"|"+x.cssChildRow+")");C.unbind("filterStart filterEnd sortEnd disable enable destroy updateComplete pageSize ".split(" ").join(".pager ")).bind("filterStart.pager",function(e,t){N.currentFilters=t;if(N.pageReset!==false&&(x.lastCombinedFilter||"")!==(t||[]).join("")){N.page=N.pageReset}}).bind("filterEnd.pager sortEnd.pager",function(){if(N.initialized){if(x.delayInit&&x.rowsCopy&&x.rowsCopy.length===0){d(h)}i(h,N,false);v(h,N,false);x.$table.trigger("applyWidgets");s(h,N)}}).bind("disable.pager",function(e){e.stopPropagation();p(h,N)}).bind("enable.pager",function(e){e.stopPropagation();S(h,N,true)}).bind("destroy.pager",function(e){e.stopPropagation();E(h,N)}).bind("updateComplete.pager",function(e,t,n){e.stopPropagation();if(!t||n){return}s(t,N);var r=x.$tbodies.eq(0).children("tr").not(x.selectorRemove);N.totalRows=r.length-(N.countChildRows?0:r.filter("."+x.cssChildRow).length);N.totalPages=Math.ceil(N.totalRows/N.size);if(r.length&&x.rowsCopy&&x.rowsCopy.length===0){d(t)}i(t,N);u(t,N)}).bind("pageSize.pager",function(e,t){e.stopPropagation();m(h,parseInt(t,10)||10,N);u(h,N);i(h,N,false);if(N.$size.length){N.$size.val(N.size)}}).bind("pageSet.pager",function(e,t){e.stopPropagation();N.page=(parseInt(t,10)||1)-1;if(N.$goto.length){N.$goto.val(N.size)}v(h,N,true);i(h,N,false)});l=[N.cssFirst,N.cssPrev,N.cssNext,N.cssLast];c=[g,w,b,y];k.find(l.join(",")).attr("tabindex",0).unbind("click.pager").bind("click.pager",function(t){t.stopPropagation();var n,r=e(this),i=l.length;if(!r.hasClass(N.cssDisabled)){for(n=0;n<i;n++){if(r.is(l[n])){c[n](h,N);break}}}});N.$goto=k.find(N.cssGoto);if(N.$goto.length){N.$goto.unbind("change").bind("change",function(){N.page=e(this).val()-1;v(h,N,true);i(h,N,false)})}N.$size=k.find(N.cssPageSize);if(N.$size.length){N.$size.find("option").removeAttr("selected");N.$size.unbind("change.pager").bind("change.pager",function(){N.$size.val(e(this).val());if(!e(this).hasClass(N.cssDisabled)){m(h,parseInt(e(this).val(),10),N);o(h,N)}return false})}N.initialized=false;C.trigger("pagerBeforeInitialized",N);S(h,N,false);if(typeof N.ajaxUrl==="string"){N.ajax=true;x.widgetOptions.filter_serversideFiltering=true;x.serverSideSorting=true;v(h,N)}else{N.ajax=false;e(this).trigger("appendCache",true);a(h,N)}o(h,N);if(!N.ajax){N.initialized=true;e(h).trigger("pagerInitialized",N)}})}}});t.showError=function(t,n){e(t).each(function(){var t,r=this.config,i=r.pager&&r.pager.cssErrorRow||r.widgetOptions.pager_css&&r.widgetOptions.pager_css.errorRow||"tablesorter-errorRow";if(r){if(typeof n==="undefined"){r.$table.find("thead").find(r.selectorRemove).remove()}else{t=(/tr\>/.test(n)?e(n):e('<tr><td colspan="'+r.columns+'">'+n+"</td></tr>")).click(function(){e(this).remove()}).appendTo(r.$table.find("thead:first")).addClass(i+" "+r.selectorRemove.replace(/^(\w+\.)/g,"")).attr({role:"alert","aria-live":"assertive"})}}})};e.fn.extend({tablesorterPager:e.tablesorterPager.construct})})(jQuery)